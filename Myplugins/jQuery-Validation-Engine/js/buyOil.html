<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="../../js/libs/js/jquery.js"></script>
<script type="text/javascript" src="../../js/layer/layer.js"></script>
<script type="text/javascript" src="../../js/comm/cusLayer.js"></script>
<script type="text/javascript" src="../../js/utils.js"></script>
<script type="text/javascript" src="../../js/comm_new/oilPickupDiscount.js"></script>

<link rel="stylesheet" type="text/css" href="../../css/common/global.css">
<link rel="stylesheet" type="text/css" href="../../css/common/common.css">
<link rel="stylesheet" type="text/css" href="../../css/oil/all_oil.css">

<script type="text/javascript" src="../../js/jquery-validataion/js/jquery.validationEngine.js" ></script>
<script type="text/javascript" src="../../js/jquery-validataion/js/languages/jquery.validationEngine-zh_CN.js" ></script>
<link rel="stylesheet" href="../../js/jquery-validataion/css/validationEngine.jquery.css" type="text/css">
<link rel="stylesheet" type="text/css" href="../../css/common/validation.css"/>

<meta charset="UTF-8">
<title>买油弹出框</title>

<script type="text/javascript">

var oilinfoId;
var oilPrice;
var realPrice;
var oilinfoName;
var fangshi="0";



$(function(){
	
	getOil();
	
});

var pcDiscount;
var cusgradePrice;
var exclusivePrice;
var shouming;



//获取参数
function getOil(){
	
	oilinfoId=getQueryString("oilInfoId");
	oilPrice=getQueryString("oilPrice");
	$("#oilPrice").val(oilPrice);
	realPrice = oilPrice;
	oilinfoName=decodeURI(getQueryString("oilinfoName"));
	
	pcDiscount=getQueryString("pcDiscount");
	cusgradePrice=getQueryString("cusgradePrice");
	exclusivePrice=getQueryString("exclusivePrice");
	shouming=decodeURI(getQueryString("shouming"));
	
	pickupDiscount = getQueryString("pickupDiscount");
	
	if (pcDiscount == "undefined") { 
		pcDiscount="";
	}
	if (cusgradePrice == "undefined") { 
		cusgradePrice="";
	}
	if (exclusivePrice == "undefined") { 
		exclusivePrice="";
	}
	if (shouming == "undefined") { 
		shouming="";
	}
	if (pickupDiscount == "undefined") { 
		pickupDiscount = 0;
	}
	if (shouming == "undefined") { 
		shouming="";
	}
	
	/* if(pcDiscount!=""){
		$("#value1").html('网上购油优惠    专享  <b class="red-font">'+pcDiscount+'</b> 元/吨');
	}
	if(cusgradePrice!=""){
		$("#value2").html('客户等级优惠     专享  <b class="red-font">'+cusgradePrice+'</b> 元/吨');
	}
	if(exclusivePrice!=""){
		$("#value3").html('客户专属优惠     专享  <b class="red-font">'+exclusivePrice+'</b> 元/吨');
	} */
	
/* 	if(shouming==""){
//		document.getElementById("youhui").style.display="none";
	}else{
//		document.getElementById("youhui").style.display="block";
		$("#value4").html(shouming);
	} */
	
}

//自提配送切换
function fun(num){
	if(num=="1"){
		$('#peisong').addClass('selected');
		$('#ziti').removeClass('selected');
		fangshi="0";
		
		oilPrice = Number(realPrice);
	}else{
		oilPrice = Number(realPrice)-Number(pickupDiscount);
		$('#peisong').removeClass('selected');
		$('#ziti').addClass('selected');
		fangshi="1";
	}
}


function afterAdd(data){
	
	if (typeof data == "string") {
		data = eval('(' + data + ')');
	}
	
	parent.showBanner(oilinfoName);
	
}
function afterPriceStrategyAdd(data){
 	var oilNumber=$('#num').val();
	var oilRealPrice=$('#oilPrice').val();
	if (typeof data == "string") {
		data = eval('(' + data + ')');
	}
	if (Number(data.price)>Number($('#oilPrice').val())) {
		alert("请根据价格策略填写价格！")
	}
	/*	alert(data.price)*/
	else{
		var paramJsonStr = {
				'oilinfoId':oilinfoId,
				'oilPrice':oilRealPrice,
				'oilNumber':oilNumber,
				'extractType':fangshi,
				'oilinfoName':oilinfoName,
				'ysfs':$('#ysfs').val(),
				'ykdd':$('#ykdd').val(),
				'xsfs':$('#xsfs').val()
		};
		ajaxPostQuery("../../front/bill/insertBill", paramJsonStr, afterAdd); 
	}
}

//加入购物车
function shopping(){
	
	var valid = $("#myFormId").validationEngine('validate');
	
	if(valid){
	
		var oilNumber=$('#num').val();
		var oilRealPrice=$('#oilPrice').val();
		//alert(oilNumber);
		if(Number(oilNumber)<=0){
			alert("请填写购油数量!");
			return;
		}else{
			var paramJsonStr = {
					'oilinfoId':oilinfoId
			};
			ajaxPostQuery("../../front/bill/checkPriceStrategy", paramJsonStr, afterPriceStrategyAdd);
			
		}
	}
}

function cancel(){
	
	parent.window.closeLayer();
	
}

</script>

</head>
<body>
	<div class="wrapper pop-window">
		<div class="margin-a content">
		<form action="" id="myFormId"  class="judge-form">
			<p class="margin-t-2x">
				<span>提油方式：</span>
       		  <a class="tag selected" onclick="fun(1)" id="peisong" >配送</a>
       		  <a class="tag " onclick="fun(2)" id="ziti" >自提</a>
		     </p>
	
		    <p class="margin-t-2x">
			 	<span>运输方式：</span>
			 	<select id="ysfs" name="ysfs" style = "width:120px">
				<option value="0">公路</option>
				<option value="1">铁路</option>
				<option value="2">水运</option>
				<option value="3">长管输</option>
				<option value="4">短管输</option>
			</select>
			 </p>
			 <p class="margin-t-2x">
			 	<span>油库地点：</span>
			 	<select id="ykdd" name="ykdd" style = "width:120px">
				<option value="Y03A">直销油库</option>
				<option value="661A">海滨油库</option>
				<option value="663A">新河油库</option>
				<option value="662A">云峰油库</option>
			</select>
			 </p>
			 <p class="margin-t-2x">
			 	<span>销售方式：</span>
			 	<select id="xsfs" name="xsfs" style = "width:120px">
				<option value="21">批发</option>
				<option value="22">小额配送</option>
				<option value="23">零售</option>
				<option value="24">内部调拨</option>
			 </select>
			 </p>
			 <p class="margin-t-2x">
			 	<span>填写数量：</span>
			 	<input class="m-input validate[required,custom[number],min[0.001]]" type="text" name="num" id="num" value="1"/><span class="gray-font">吨</span>
			 </p>
			 <p class="margin-t-2x">
			 	<span>填写价格：</span>
			 	<input class="m-input validate[required,custom[number],min[0.001]]" type="text" name="oilPrice" id="oilPrice"/><span class="gray-font">元/吨</span>
			 </p>
			 <p class="margin-t-2x">

					<input type="checkbox" name="chk" id="chk" disabled="disabled"/><span>按出库量结算</span>
			 </p>

			<!--  <div class="margin-t-2x m-lineheight w-text-font gray-font clearfix">
			 	<div class="left bold">专属优惠：</div>
			 	<div class="left">
			 		<p id="value1"></p>
					<p id="value2"></p>
					<p id="value3"></p>
			 	</div>	 	
			 </div>
			 <div  class="margin-t m-lineheight w-text-font gray-font clearfix">
			 	<div id="youhui" class="left bold">优惠活动：</div>
			 	<div class="left">
			 		<p id="value4"></p>
			 	</div>
			 </div> -->
			 <div class="action-group">
	 			  <button class="btn-small btn-main btn-submit" type="button" onclick="shopping()">确定</button>
				  <button class="btn-small m-btn btn-back margin-l-2x" type="button" onclick="cancel()">取消</button>
			 </div>
		</form>
		</div>
	</div>
</body>
</html>